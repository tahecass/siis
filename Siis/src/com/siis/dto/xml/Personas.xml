<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="PersonaMapper">
	<resultMap id="resMapPersona" type="PersonaAlias">
		<result property="secuencia" column="SECUENCIA" />
		<result property="nombreContacto" column="NOMBRE" />
		<result property="apellidoContacto" column="APELLIDO" />
		<result property="correoElectronico" column="DIRECCION_CORREO" />
		<result property="telefonoMovil" column="TELEFONO" />	
		<result property="sexo" column="SEXO" />	
		<result property="fechaNacimiento" column="FECHA_NACIMIENTO" />	
		<result property="tipoIdentificacion" column="TIPO_IDENTIFICACION" />	
		<result property="nit" column="IDENTIFICACION" />	
		<result property="tipo" column="TIPO" />	
		<result property="estado" column="ESTADO" />	
		<result property="descrpcion" column="DESCRPCION" />	
		
        <result property="nombreCompleto" column="NOMBRE_COMPLETO" />
		
		<result property="secUsuario" column="sec_usuario" />	
		<result property="secGrupo" column="SEC_GRUPO" />	
		<result property="clave" column="CLAVE" />
		
	</resultMap>
	
	
	<select id="guardarPersonas" parameterType="PersonaAlias" resultMap="resMapPersona"  > 
	 <![CDATA[
		
		
		INSERT
INTO
  PERSONAS
  (
    SECUENCIA,
    NOMBRE,
    APELLIDO,
    DIRECCION_CORREO,
    TELEFONO,
    SEXO,
    FECHA_NACIMIENTO,
    TIPO_IDENTIFICACION,
    IDENTIFICACION,
    TIPO,
    ESTADO,
    DESCRIPCION
  )
  VALUES
  (
  #{secuencia,jdbcType=NUMERIC},
  #{nombreContacto,jdbcType=VARCHAR},
  #{apellidoContacto,jdbcType=VARCHAR},
  #{correoElectronico,jdbcType=VARCHAR},
	 #{telefonoMovil,jdbcType=VARCHAR},
	  #{sexo,jdbcType=VARCHAR}, 
	  #{fechaNacimiento,jdbcType=DATE},
	   #{tipoIdentificacion,jdbcType=VARCHAR},
	    
	 #{nit,jdbcType=VARCHAR}, 
	 #{tipo,jdbcType=VARCHAR},
	 #{estado,jdbcType=VARCHAR},
	  #{descrpcion,jdbcType=VARCHAR}
  )
		
		]]>       
	</select>
	
	
	
	<select id="actualizarPersonas" parameterType="PersonaAlias" resultMap="resMapPersona"  > 
	 <![CDATA[
		
     UPDATE
  PERSONAS
SET
 NOMBRE              = #{nombreContacto,jdbcType=VARCHAR},
 APELLIDO            = #{apellidoContacto,jdbcType=VARCHAR},
 DIRECCION_CORREO    = #{correoElectronico,jdbcType=VARCHAR},
 TELEFONO            = #{telefonoMovil,jdbcType=VARCHAR},
 SEXO                = #{sexo,jdbcType=VARCHAR},
 FECHA_NACIMIENTO    = #{fechaNacimiento,jdbcType=DATE},
 TIPO_IDENTIFICACION = #{tipoIdentificacion,jdbcType=VARCHAR},
 IDENTIFICACION      = #{nit,jdbcType=VARCHAR},
 TIPO                = #{tipo,jdbcType=VARCHAR},
 ESTADO              = #{estado,jdbcType=VARCHAR},
 DESCRIPCION         = #{descrpcion,jdbcType=VARCHAR}

WHERE
  SECUENCIA          = #{secuencia,jdbcType=NUMERIC}
		
		]]>       
	</select>
	
	
	<select id="listaPersonas" parameterType="PersonaAlias" resultMap="resMapPersona"  > 
	 
		
			select us.SECUENCIA  sec_usuario ,
			       us.CLAVE, 
			       us.SEC_GRUPO,  
		       
		          p.SECUENCIA,
				  p.NOMBRE, 
				  p.APELLIDO, 
				  p.DIRECCION_CORREO,
				  p.TELEFONO,  
				  p.SEXO,       
				  p.FECHA_NACIMIENTO,         
				  p.TIPO_IDENTIFICACION,     
				  p.IDENTIFICACION, 
				  p.TIPO,   
				  p.ESTADO,       
				  p.DESCRIPCION,
				  P.APELLIDO ||' ' || p.NOMBRE  NOMBRE_COMPLETO
		    from personas p 
		INNER JOIN USUARIOS us
		on p.SECUENCIA = us.SEC_PERSONA
		<trim prefix="WHERE" prefixOverrides="AND | OR ">
	   		<if test="codigo !=null and  codigo != ''">
	   		       p.IDENTIFICACION  LIKE   (#{codigo,jdbcType=VARCHAR})
	   		  OR   p.NOMBRE  LIKE   (#{codigo,jdbcType=VARCHAR})
	   		  OR   p.APELLIDO LIKE   (#{codigo,jdbcType=VARCHAR}) 
	    	</if>
	    </trim>
      
	</select>
	
		<select id="siguientePkPersonas" parameterType="PersonaAlias" resultMap="resMapPersona"  > 
	 <![CDATA[
		
		select max(secuencia)+1 secuencia  from   personas 

		
		]]>       
	</select>
		
</mapper>

	



