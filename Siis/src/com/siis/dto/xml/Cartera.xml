<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="CarteraMapper">
	<resultMap id="resMapCartera" type="CarteraAlias">
		<result property="secuencia" column="SECUENCIA_CARTERA" />
		<result property="usuario.secuencia" column="SECUENCIA_USUARIO" />
		<result property="usuario.cuental" column="CUENTA" />
		<result property="cliente.secuencia" column="SECUENCIA_PERSONA" />
		<result property="cliente.nombreRazonSocial" column="NOMBRE_RAZON_SOCIAL" />
		<result property="fechaPago" column="FECHA_PAGO" />
		<result property="fechaHoraActualizacion" column="FECHA_HORA_ACTUALIZACION" />
				
	</resultMap>	
 
   
	<select id="guardarCartera" parameterType="CarteraAlias" resultMap="resMapCartera" statementType="CALLABLE" >   
		{ call
			DECLARE
				VAR_SECUENCIA NUMERIC;
			BEGIN
				 VAR_SECUENCIA := 5;			
			     #{secuencia,jdbcType=NUMERIC} := VAR_SECUENCIA;
				
				
				 INSERT
				   INTO CARTERAS (SECUENCIA, SECUENCIA_USUARIO, SECUENCIA_CLIENTE, FECHA_PAGO, FECHA_HORA_ACTUALIZACION)
					  VALUES
					  (VAR_SECUENCIA,
					   #{usuario.secuencia,jdbcType=NUMERIC},
					   #{cliente.secuencia,jdbcType=NUMERIC},
					   #{fechaPago,jdbcType=DATE},
					   #{fechaHoraActualizacion,jdbcType=DATE}
					  ) 
		       	END
		  }
	</select>
	<update id="actualizarConvenio" parameterType="CarteraAlias">
	  UPDATE CARTERAS 
	     SET SECUENCIA =[value-1],
	     SECUENCIA_USUARIO =[value-2],
	     SECUENCIA_CLIENTE=[value-3],
	     FECHA_PAGO=[value-4],
	     FECHA_HORA_ACTUALIZACION= [value-5] 
	     WHERE 1
	</update>
	<select id="listarCarterasPorClientes" parameterType="CarteraAlias" resultMap="resMapCartera"  > 
		SELECT 
		  CARTERAS.SECUENCIA AS SECUENCIA_CARTERA, 
		  CARTERAS.FECHA_PAGO, 
		  CARTERAS.SECUENCIA_USUARIO, 
		  CARTERAS.SECUENCIA_CLIENTE, 
		  CARTERAS.FECHA_HORA_ACTUALIZACION,
		  CLIENTES.NOMBRE_RAZON_SOCIAL, 
		  CLIENTES.NIT, 
		  CLIENTES.SECUENCIA_PERSONA, 
		  USUARIOS.CUENTA
		FROM 
		  CARTERAS
		  LEFT JOIN  CLIENTES ON CLIENTES.SECUENCIA = CARTERAS.SECUENCIA_CLIENTE 
		  LEFT JOIN  USUARIOS ON USUARIOS.SECUENCIA = CARTERAS.SECUENCIA_USUARIO
	    WHERE CARTERAS.SECUENCIA_CLIENTE=  #{cliente.secuencia,jdbcType=NUMERIC};
 </select>
 <select id="obtenerCartera" parameterType="CarteraAlias" resultMap="resMapCartera"  > 
		SELECT 
		  CARTERAS.SECUENCIA AS SECUENCIA_CARTERA, 
		  CARTERAS.FECHA_PAGO, 
		  CARTERAS.SECUENCIA_USUARIO, 
		  CARTERAS.SECUENCIA_CLIENTE, 
		  CARTERAS.FECHA_HORA_ACTUALIZACION,
		  CLIENTES.NOMBRE_RAZON_SOCIAL, 
		  CLIENTES.NIT, 
		  CLIENTES.SECUENCIA_PERSONA, 
		  USUARIOS.CUENTA
		FROM 
		  CARTERAS
		  LEFT JOIN  CLIENTES ON CLIENTES.SECUENCIA = CARTERAS.SECUENCIA_CLIENTE 
		  LEFT JOIN  USUARIOS ON USUARIOS.SECUENCIA = CARTERAS.SECUENCIA_USUARIO
	    WHERE CARTERAS.SECUENCIA=  #{secuencia,jdbcType=NUMERIC};
 </select>
</mapper>


